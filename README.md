<!-- # MITM Proxy Python

**MITM Proxy** — это перехватывающий HTTP/HTTPS прокси-сервер, написанный на Python.

Он позволяет:

- Проксировать и логировать HTTP и HTTPS-запросы
- Повторно отправлять и анализировать перехваченные запросы через веб-интерфейс
- Выполнять базовый анализ уязвимостей (XSS, SQLi)

---

## Запуск проекта

### 1. Генерация корневого сертификат

```bash
make gen-cert
```

Создаются:

- `ca.key` — приватный ключ CA
- `ca.crt` — публичный корневой сертификат
- `cert.key` — ключ, на базе которого подписываются поддельные host-сертификаты

### 2. Сборка и запуск Docker

```bash
make docker-build
make docker-start
```

Прокси слушает:

- `http://localhost:8080` — HTTP/HTTPS прокси
- `http://localhost:8000` — REST API

### 3. Установка сертификата CA в систему (Windows):

```powershell
certutil -addstore -f "Root" ca.crt
```

Для Linux/macOS — открой `ca.crt` и импортируй в системное хранилище.

### 4. Проверка:

```bash
curl -x http://127.0.0.1:8080 http://example.com
curl -x http://127.0.0.1:8080 https://mail.ru -v --ssl-no-revoke --tlsv1.2
```

---

## Возможности

### Проксирование HTTP(S)

- Прокси перехватывает и обрабатывает все типы HTTP-запросов (GET, POST, PUT, OPTIONS и др)
- Поддержка TLS MITM: сертификаты генерируются "на лету" под каждый домен

### REST API (порт 8000)

| Метод | Путь             | Описание                   |
| ----- | ---------------- | -------------------------- |
| GET   | `/requests`      | Список всех запросов       |
| GET   | `/requests/<id>` | Подробности одного запроса |
| POST  | `/repeat/<id>`   | Повторить отправку запроса |
| POST  | `/scan/<id>`     | Выполнить базовый анализ   |

---

## Остановка и очистка

```bash
make docker-stop     # Остановить контейнер
make clean-certs     # Удалить временные сертификаты
```

---

## Ограничения

- Не используются внешние прокси-библиотеки (например, `mitmproxy`, `proxy.py`)
- Всё реализовано с использованием стандартных Python-библиотек и `openssl`

---

Проект выполнен в рамках учебного задания — VK Edu
MITM-прокси с REST-интерфейсом. Пригоден для анализа трафика и изучения принципов работы HTTPS. -->



# MITM Proxy Python

**MITM Proxy** — это перехватывающий HTTP/HTTPS прокси-сервер, написанный на Python.

Он позволяет:

- Проксировать и логировать HTTP и HTTPS-запросы
- Повторно отправлять и анализировать перехваченные запросы через веб-интерфейс
- Выполнять базовый анализ уязвимостей (XSS, SQLi)

---

## Запуск проекта

### 1. Генерация корневого сертификат

```bash
make gen-cert
```

Создаются:

- `ca.key` — приватный ключ CA
- `ca.crt` — публичный корневой сертификат
- `cert.key` — ключ, на базе которого подписываются поддельные host-сертификаты

### 2. Сборка и запуск Docker

```bash
make docker-build
make docker-start
```

Прокси слушает:

- `http://localhost:8080` — HTTP/HTTPS прокси
- `http://localhost:8000` — REST API

### 3. Установка сертификата CA в систему (Windows):

```powershell
certutil -addstore -f "Root" ca.crt
```

Для Linux/macOS — открой `ca.crt` и импортируй в системное хранилище.

### 4. Проверка:

```bash
curl -x http://127.0.0.1:8080 http://example.com
curl -x http://127.0.0.1:8080 https://mail.ru -v --ssl-no-revoke --tlsv1.2
```

---

## Возможности

### Проксирование HTTP(S)

- Прокси перехватывает и обрабатывает все типы HTTP-запросов (GET, POST, PUT, OPTIONS и др)
- Поддержка TLS MITM: сертификаты генерируются "на лету" под каждый домен

### REST API (порт 8000)

| Метод | Путь             | Описание                   |
| ----- | ---------------- | -------------------------- |
| GET   | `/requests`      | Список всех запросов       |
| GET   | `/requests/<id>` | Подробности одного запроса |
| POST  | `/repeat/<id>`   | Повторить отправку запроса |
| POST  | `/scan/<id>`     | Выполнить базовый анализ   |

---

## Остановка и очистка

```bash
make docker-stop     # Остановить контейнер
make clean-certs     # Удалить временные сертификаты
```

---

## Задание 1: Проксирование HTTP

1. Убедитесь, что прокси работает:
    ```bash
    curl -x http://127.0.0.1:8080 http://mail.ru
    ```
2. Ответ должен содержать `301 Moved Permanently`.

---

## Задание 2: Проксирование HTTPS

1. Добавьте `ca.crt` в системные доверенные сертификаты.
2. Выполните команду:
    ```bash
    curl -x http://127.0.0.1:8080 https://mail.ru -v --ssl-no-revoke --tlsv1.2
    ```
3. Должен загрузиться ответ от `https://mail.ru`.

---

## Задание 3: Сохранение и повторная отправка

1. Все запросы автоматически сохраняются в PostgreSQL.
2. Посмотреть список:
    ```bash
    curl http://localhost:8000/requests
    ```
3. Посмотреть конкретный:
    ```bash
    curl http://localhost:8000/requests/<id>
    ```
4. Повторно отправить:
    ```bash
    curl -X POST http://localhost:8000/repeat/<id>
    ```

---

## Задание 4: Сканер уязвимостей (XXE)

1. Добавьте XML в тело запроса.
2. Используйте API:
    ```bash
    curl -X POST http://localhost:8000/scan/<id>
    ```
3. Если в ответе будет `root:`, значит запрос уязвим к XXE.

---

## Альтернативный интерфейс

Для удобства можно запустить "обёртку"-портал:

```bash
python3 api/proxy_wrapper.py
```

Доступен по адресу:

```
http://localhost:8888/?url=http://mail.ru
```

Он проксирует запросы через ваш MITM-прокси и отображает результат в браузере.

---

Проект выполнен в рамках учебного задания — VK Edu
